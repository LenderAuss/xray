#!/bin/bash
apt update
apt install qrencode curl jq bc -y

# –í–∫–ª—é—á–∞–µ–º bbr
bbr=$(sysctl -a | grep net.ipv4.tcp_congestion_control)
if [ "$bbr" = "net.ipv4.tcp_congestion_control = bbr" ]; then
    echo "bbr —É–∂–µ –≤–∫–ª—é—á–µ–Ω"
else
    echo "net.core.default_qdisc=fq" >> /etc/sysctl.conf
    echo "net.ipv4.tcp_congestion_control=bbr" >> /etc/sysctl.conf
    sysctl -p
    echo "bbr –≤–∫–ª—é—á–µ–Ω"
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —è–¥—Ä–æ Xray
bash -c "$(curl -4 -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)" @ install

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª—é—á–∏
[ -f /usr/local/etc/xray/.keys ] && rm /usr/local/etc/xray/.keys
touch /usr/local/etc/xray/.keys
echo "shortsid: $(openssl rand -hex 8)" >> /usr/local/etc/xray/.keys
echo "uuid: $(xray uuid)" >> /usr/local/etc/xray/.keys
xray x25519 >> /usr/local/etc/xray/.keys

export uuid=$(cat /usr/local/etc/xray/.keys | awk -F': ' '/uuid/ {print $2}')
export privatkey=$(cat /usr/local/etc/xray/.keys | awk -F': ' '/PrivateKey/ {print $2}')
export shortsid=$(cat /usr/local/etc/xray/.keys | awk -F': ' '/shortsid/ {print $2}')

# –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É —Å–æ–∑–¥–∞–Ω–∏—è –¥–ª—è main –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
main_creation_date=$(date '+%Y-%m-%d %H:%M:%S')

# –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Xray
cat << EOF > /usr/local/etc/xray/config.json
{
    "log": {
        "loglevel": "warning"
    },
    "routing": {
        "domainStrategy": "IPIfNonMatch",
        "rules": [
            {
                "type": "field",
                "domain": [
                    "geosite:category-ads-all"
                ],
                "outboundTag": "block"
            }
        ]
    },
    "inbounds": [
        {
            "listen": "0.0.0.0",
            "port": 443,
            "protocol": "vless",
            "settings": {
                "clients": [
                    {
                        "email": "main",
                        "id": "$uuid",
                        "flow": "xtls-rprx-vision",
                        "metadata": {
                            "subscription": "y",
                            "created_date": "$main_creation_date"
                        }
                    }
                ],
                "decryption": "none"
            },
            "streamSettings": {
                "network": "tcp",
                "security": "reality",
                "realitySettings": {
                    "show": false,
                    "dest": "google.com:443",
                    "xver": 0,
                    "serverNames": [
                        "google.com",
                        "www.google.com"
                    ],
                    "privateKey": "$privatkey",
                    "minClientVer": "",
                    "maxClientVer": "",
                    "maxTimeDiff": 0,
                    "shortIds": [
                        "$shortsid"
                    ]
                }
            },
            "sniffing": {
                "enabled": true,
                "destOverride": [
                    "http",
                    "tls"
                ]
            }
        }
    ],
    "outbounds": [
        {
            "protocol": "freedom",
            "tag": "direct"
        },
        {
            "protocol": "blackhole",
            "tag": "block"
        }
    ],
    "policy": {
        "levels": {
            "0": {
                "handshake": 3,
                "connIdle": 180
            }
        }
    }
}
EOF

# –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
cat << 'SCRIPT' > /usr/local/bin/userlist
#!/bin/bash
clients=$(jq -c '.inbounds[0].settings.clients[]' /usr/local/etc/xray/config.json)

if [[ -z "$clients" ]]; then
    echo "–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—É—Å—Ç"
    exit 1
fi

echo "======================================================"
echo "–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤:"
echo "======================================================"
i=1
while IFS= read -r client; do
    email=$(echo "$client" | jq -r '.email')
    subscription=$(echo "$client" | jq -r '.metadata.subscription // "n/a"')
    created_date=$(echo "$client" | jq -r '.metadata.created_date // "n/a"')
    uuid=$(echo "$client" | jq -r '.id')
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    if [[ "$uuid" == DISABLED-* ]] || [[ "$uuid" == EXPIRED-* ]] || [[ "$uuid" == "00000000-0000-0000-0000-000000000000" ]]; then
        status="üî¥ –û–¢–ö–õ–Æ–ß–ï–ù"
    else
        status="üü¢ –ê–∫—Ç–∏–≤–µ–Ω"
    fi
    
    echo "$i. $email - $status"
    echo "   –ü–æ–¥–ø–∏—Å–∫–∞: $subscription"
    echo "   –°–æ–∑–¥–∞–Ω: $created_date"
    echo "------------------------------------------------------"
    ((i++))
done <<< "$clients"
SCRIPT
chmod +x /usr/local/bin/userlist

# –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –¥–ª—è —Å—Å—ã–ª–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
cat << 'SCRIPT' > /usr/local/bin/mainuser
#!/bin/bash
protocol=$(jq -r '.inbounds[0].protocol' /usr/local/etc/xray/config.json)
port=$(jq -r '.inbounds[0].port' /usr/local/etc/xray/config.json)
uuid=$(jq -r '.inbounds[0].settings.clients[0].id' /usr/local/etc/xray/config.json)
pbk=$(cat /usr/local/etc/xray/.keys | awk -F': ' '/Password/ {print $2}')
sid=$(cat /usr/local/etc/xray/.keys | awk -F': ' '/shortsid/ {print $2}')
sni=$(jq -r '.inbounds[0].streamSettings.realitySettings.serverNames[0]' /usr/local/etc/xray/config.json)
ip=$(timeout 3 curl -4 -s icanhazip.com)
link="$protocol://$uuid@$ip:$port?security=reality&sni=$sni&fp=chrome&pbk=$pbk&sid=$sid&spx=/&type=tcp&flow=xtls-rprx-vision&encryption=none#main"
echo ""
echo "–°—Å—ã–ª–∫–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:"
echo "$link"
echo ""
echo "QR-–∫–æ–¥:"
echo ${link} | qrencode -t ansiutf8
SCRIPT
chmod +x /usr/local/bin/mainuser

# –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
cat << 'SCRIPT' > /usr/local/bin/newuser
#!/bin/bash
read -p "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: " email

if [[ -z "$email" || "$email" == *" "* ]]; then
    echo "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
existing_user=$(jq --arg email "$email" '.inbounds[0].settings.clients[] | select(.email == $email)' /usr/local/etc/xray/config.json)
if [[ -n "$existing_user" ]]; then
    echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
    exit 1
fi

# –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–∏–ø –ø–æ–¥–ø–∏—Å–∫–∏
while true; do
    read -p "–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞? (y/n): " subscription
    subscription=$(echo "$subscription" | tr '[:upper:]' '[:lower:]')
    if [[ "$subscription" == "y" || "$subscription" == "n" ]]; then
        break
    else
        echo "–û—à–∏–±–∫–∞: –≤–≤–µ–¥–∏—Ç–µ 'y' (–¥–∞) –∏–ª–∏ 'n' (–Ω–µ—Ç)"
    fi
done

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π UUID
uuid=$(xray uuid)

# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
creation_date=$(date '+%Y-%m-%d %H:%M:%S')

# –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
jq --arg email "$email" \
   --arg uuid "$uuid" \
   --arg subscription "$subscription" \
   --arg created_date "$creation_date" \
   '.inbounds[0].settings.clients += [{
       "email": $email,
       "id": $uuid,
       "flow": "xtls-rprx-vision",
       "metadata": {
           "subscription": $subscription,
           "created_date": $created_date
       }
   }]' /usr/local/etc/xray/config.json > tmp.json && mv tmp.json /usr/local/etc/xray/config.json

systemctl restart xray

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É
protocol=$(jq -r '.inbounds[0].protocol' /usr/local/etc/xray/config.json)
port=$(jq -r '.inbounds[0].port' /usr/local/etc/xray/config.json)
pbk=$(cat /usr/local/etc/xray/.keys | awk -F': ' '/Password/ {print $2}')
sid=$(cat /usr/local/etc/xray/.keys | awk -F': ' '/shortsid/ {print $2}')
sni=$(jq -r '.inbounds[0].streamSettings.realitySettings.serverNames[0]' /usr/local/etc/xray/config.json)
ip=$(curl -4 -s icanhazip.com)
link="$protocol://$uuid@$ip:$port?security=reality&sni=$sni&fp=chrome&pbk=$pbk&sid=$sid&spx=/&type=tcp&flow=xtls-rprx-vision&encryption=none#$email"

echo ""
echo "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω!"
echo "   –ò–º—è: $email"
echo "   –ü–æ–¥–ø–∏—Å–∫–∞: $subscription"
echo "   –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: $creation_date"
echo ""
echo "–°—Å—ã–ª–∫–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:"
echo "$link"
echo ""
echo "QR-–∫–æ–¥:"
echo ${link} | qrencode -t ansiutf8
SCRIPT
chmod +x /usr/local/bin/newuser

# ============================================================================
# ‚úÖ –ù–û–í–ê–Ø –ö–û–ú–ê–ù–î–ê: disableuser - –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è
# ============================================================================
# –í–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è - "–ø–æ—Ä—Ç–∏—Ç" UUID, –¥–µ–ª–∞—è –∫–ª—é—á –Ω–µ—Ä–∞–±–æ—á–∏–º
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ, –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ —Å —Ç–µ–º –∂–µ –∏–º–µ–Ω–µ–º
# ============================================================================

cat << 'SCRIPT' > /usr/local/bin/disableuser
#!/bin/bash

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

CONFIG_FILE="/usr/local/etc/xray/config.json"

# –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
read -p "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è: " selected_email

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–µ –∏–º—è
if [[ -z "$selected_email" ]]; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: –∏–º—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º${NC}"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_exists=$(jq -r --arg email "$selected_email" \
  '.inbounds[0].settings.clients[] | select(.email == $email) | .email' \
  "$CONFIG_FILE")

if [[ -z "$user_exists" ]]; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å '$selected_email' –Ω–µ –Ω–∞–π–¥–µ–Ω${NC}"
    exit 1
fi

# –ó–∞—â–∏—Ç–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
if [[ "$selected_email" == "main" ]]; then
    echo -e "${RED}‚ùå –ù–µ–ª—å–∑—è –æ—Ç–∫–ª—é—á–∏—Ç—å –≥–ª–∞–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!${NC}"
    exit 1
fi

# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π UUID (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
current_uuid=$(jq -r --arg email "$selected_email" \
  '.inbounds[0].settings.clients[] | select(.email == $email) | .id' \
  "$CONFIG_FILE")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω –ª–∏ —É–∂–µ
if [[ "$current_uuid" == DISABLED-* ]] || [[ "$current_uuid" == EXPIRED-* ]] || [[ "$current_uuid" == "00000000-0000-0000-0000-000000000000" ]]; then
    echo -e "${YELLOW}‚ö†Ô∏è  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å '$selected_email' —É–∂–µ –æ—Ç–∫–ª—é—á–µ–Ω${NC}"
    echo "   –¢–µ–∫—É—â–∏–π UUID: $current_uuid"
    exit 0
fi

echo -e "${YELLOW}–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: $selected_email${NC}"
echo "–¢–µ–∫—É—â–∏–π UUID: $current_uuid"

# –°–æ–∑–¥–∞–µ–º "–∏—Å–ø–æ—Ä—á–µ–Ω–Ω—ã–π" UUID —Å timestamp
TIMESTAMP=$(date +%s)
DISABLED_UUID="DISABLED-$TIMESTAMP-00000000-0000-0000-0000"

echo "–ù–æ–≤—ã–π UUID: $DISABLED_UUID"

# –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
read -p "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ (y/n): " confirm

if [[ "$confirm" != "y" && "$confirm" != "Y" ]]; then
    echo "–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ"
    exit 0
fi

# –ú–µ–Ω—è–µ–º UUID –∏ subscription –Ω–∞ 'expired'
jq --arg email "$selected_email" \
   --arg disabled_uuid "$DISABLED_UUID" \
   '(.inbounds[0].settings.clients[] | select(.email == $email) | .id) = $disabled_uuid |
    (.inbounds[0].settings.clients[] | select(.email == $email) | .metadata.subscription) = "expired"' \
   "$CONFIG_FILE" > "${CONFIG_FILE}.tmp"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ jq –æ—Ç—Ä–∞–±–æ—Ç–∞–ª —É—Å–ø–µ—à–Ω–æ
if [ $? -eq 0 ]; then
    mv "${CONFIG_FILE}.tmp" "$CONFIG_FILE"
    
    # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º Xray
    systemctl restart xray
    
    echo -e "${GREEN}‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å $selected_email –æ—Ç–∫–ª—é—á–µ–Ω${NC}"
    echo "   - UUID –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: $DISABLED_UUID"
    echo "   - Subscription: expired"
    echo "   - –°—Ç–∞—Ä—ã–π –∫–ª—é—á –±–æ–ª—å—à–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
    echo "   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ"
    echo ""
    echo -e "${YELLOW}‚ÑπÔ∏è  –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∏–º–µ–Ω–µ–º '$selected_email'${NC}"
    echo -e "${YELLOW}   –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'${NC}"
else
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏${NC}"
    rm -f "${CONFIG_FILE}.tmp"
    exit 1
fi
SCRIPT
chmod +x /usr/local/bin/disableuser

# ============================================================================
# ‚úÖ –ù–û–í–ê–Ø –ö–û–ú–ê–ù–î–ê: listdisabled - –°–ø–∏—Å–æ–∫ –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
# ============================================================================

cat << 'SCRIPT' > /usr/local/bin/listdisabled
#!/bin/bash
CONFIG_FILE="/usr/local/etc/xray/config.json"

echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "  –û–¢–ö–õ–Æ–ß–ï–ù–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"

disabled_users=$(jq -r '.inbounds[0].settings.clients[] | 
  select(.id | startswith("DISABLED") or . == "00000000-0000-0000-0000-000000000000" or startswith("EXPIRED")) | 
  "\(.email) - UUID: \(.id) - Subscription: \(.metadata.subscription // "n/a") - Created: \(.metadata.created_date // "n/a")"' \
  "$CONFIG_FILE")

if [[ -z "$disabled_users" ]]; then
    echo "–ù–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
else
    echo "$disabled_users"
fi

echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
SCRIPT
chmod +x /usr/local/bin/listdisabled

# –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (–ü–û –ò–ú–ï–ù–ò!)
cat << 'SCRIPT' > /usr/local/bin/rmuser
#!/bin/bash
CONFIG_FILE="/usr/local/etc/xray/config.json"

# –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ email
emails=($(jq -r '.inbounds[0].settings.clients[].email' "$CONFIG_FILE"))

if [[ ${#emails[@]} -eq 0 ]]; then
    echo "–ù–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è."
    exit 1
fi

echo "–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤:"
for i in "${!emails[@]}"; do
    email="${emails[$i]}"
    subscription=$(jq -r --arg email "$email" '.inbounds[0].settings.clients[] | select(.email == $email) | .metadata.subscription // "n/a"' "$CONFIG_FILE")
    echo "$((i+1)). $email (–ø–æ–¥–ø–∏—Å–∫–∞: $subscription)"
done

echo ""
read -p "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è: " selected_email

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–º—è –Ω–µ –ø—É—Å—Ç–æ–µ
if [[ -z "$selected_email" ]]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –∏–º—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_exists=$(jq -r --arg email "$selected_email" '.inbounds[0].settings.clients[] | select(.email == $email) | .email' "$CONFIG_FILE")

if [[ -z "$user_exists" ]]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å '$selected_email' –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

# –ó–∞—â–∏—Ç–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
if [[ "$selected_email" == "main" ]]; then
    echo "‚ùå –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –≥–ª–∞–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!"
    exit 1
fi

# –ü–æ–ª—É—á–∞–µ–º UUID –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
uuid=$(jq -r --arg email "$selected_email" '.inbounds[0].settings.clients[] | select(.email == $email) | .id' "$CONFIG_FILE")

echo "–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: $selected_email (UUID: $uuid)"
read -p "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ (y/n): " confirm

if [[ "$confirm" != "y" && "$confirm" != "Y" ]]; then
    echo "–£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ"
    exit 0
fi

# –£–¥–∞–ª—è–µ–º –ü–û EMAIL
jq --arg email "$selected_email" \
   '.inbounds[0].settings.clients |= map(select(.email != $email))' \
   "$CONFIG_FILE" > "${CONFIG_FILE}.tmp" && mv "${CONFIG_FILE}.tmp" "$CONFIG_FILE"

if [ $? -eq 0 ]; then
    systemctl restart xray
    echo "‚úÖ –ö–ª–∏–µ–Ω—Ç $selected_email —É–¥–∞–ª—ë–Ω."
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ $selected_email"
    exit 1
fi
SCRIPT
chmod +x /usr/local/bin/rmuser

# –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–æ–∫
cat << 'SCRIPT' > /usr/local/bin/sharelink
#!/bin/bash
CONFIG_FILE="/usr/local/etc/xray/config.json"

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏
emails=($(jq -r '.inbounds[0].settings.clients[].email' "$CONFIG_FILE"))

if [[ ${#emails[@]} -eq 0 ]]; then
    echo "–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—É—Å—Ç"
    exit 1
fi

echo "======================================================"
echo "–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤:"
echo "======================================================"
for i in "${!emails[@]}"; do
    email="${emails[$i]}"
    subscription=$(jq -r --arg email "$email" '.inbounds[0].settings.clients[] | select(.email == $email) | .metadata.subscription // "n/a"' "$CONFIG_FILE")
    echo "$((i+1)). $email (–ø–æ–¥–ø–∏—Å–∫–∞: $subscription)"
done
echo "======================================================"
echo ""

# –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
read -p "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: " selected_email

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–º—è –Ω–µ –ø—É—Å—Ç–æ–µ
if [[ -z "$selected_email" ]]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –∏–º—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_exists=$(jq -r --arg email "$selected_email" '.inbounds[0].settings.clients[] | select(.email == $email) | .email' "$CONFIG_FILE")

if [[ -z "$user_exists" ]]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å '$selected_email' –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

# –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
protocol=$(jq -r '.inbounds[0].protocol' "$CONFIG_FILE")
port=$(jq -r '.inbounds[0].port' "$CONFIG_FILE")
uuid=$(jq -r --arg email "$selected_email" '.inbounds[0].settings.clients[] | select(.email == $email) | .id' "$CONFIG_FILE")
pbk=$(cat /usr/local/etc/xray/.keys | awk -F': ' '/Password/ {print $2}')
sid=$(cat /usr/local/etc/xray/.keys | awk -F': ' '/shortsid/ {print $2}')
sni=$(jq -r '.inbounds[0].streamSettings.realitySettings.serverNames[0]' "$CONFIG_FILE")
ip=$(curl -4 -s icanhazip.com)

# –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É
link="$protocol://$uuid@$ip:$port?security=reality&sni=$sni&fp=chrome&pbk=$pbk&sid=$sid&spx=/&type=tcp&flow=xtls-rprx-vision&encryption=none#$selected_email"

echo ""
echo "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω: $selected_email"
echo ""
echo "–°—Å—ã–ª–∫–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:"
echo "$link"
echo ""
echo "QR-–∫–æ–¥:"
echo ${link} | qrencode -t ansiutf8
SCRIPT
chmod +x /usr/local/bin/sharelink

# –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
cat << 'SCRIPT' > /usr/local/bin/userinfo
#!/bin/bash
emails=($(jq -r '.inbounds[0].settings.clients[].email' /usr/local/etc/xray/config.json))

if [[ ${#emails[@]} -eq 0 ]]; then
    echo "–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—É—Å—Ç"
    exit 1
fi

echo "–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤:"
for i in "${!emails[@]}"; do
    echo "$((i+1)). ${emails[$i]}"
done

read -p "–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: " client

if ! [[ "$client" =~ ^[0-9]+$ ]] || (( client < 1 || client > ${#emails[@]} )); then
    echo "–û—à–∏–±–∫–∞: –Ω–æ–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ ${#emails[@]}"
    exit 1
fi

selected_index=$((client - 1))
selected_email="${emails[$selected_index]}"

# –ü–æ–ª—É—á–∞–µ–º –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
protocol=$(jq -r '.inbounds[0].protocol' /usr/local/etc/xray/config.json)
port=$(jq -r '.inbounds[0].port' /usr/local/etc/xray/config.json)
uuid=$(jq --argjson index "$selected_index" -r '.inbounds[0].settings.clients[$index].id' /usr/local/etc/xray/config.json)
subscription=$(jq --argjson index "$selected_index" -r '.inbounds[0].settings.clients[$index].metadata.subscription // "n/a"' /usr/local/etc/xray/config.json)
created_date=$(jq --argjson index "$selected_index" -r '.inbounds[0].settings.clients[$index].metadata.created_date // "n/a"' /usr/local/etc/xray/config.json)

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
if [[ "$uuid" == DISABLED-* ]] || [[ "$uuid" == EXPIRED-* ]] || [[ "$uuid" == "00000000-0000-0000-0000-000000000000" ]]; then
    status="üî¥ –û–¢–ö–õ–Æ–ß–ï–ù"
else
    status="üü¢ –ê–∫—Ç–∏–≤–µ–Ω"
fi

echo ""
echo "======================================================"
echo "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ: $selected_email"
echo "======================================================"
echo "–°—Ç–∞—Ç—É—Å: $status"
echo "–ü—Ä–æ—Ç–æ–∫–æ–ª: $protocol"
echo "–ü–æ—Ä—Ç: $port"
echo "UUID: $uuid"
echo "–ü–æ–¥–ø–∏—Å–∫–∞: $subscription"
echo "–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: $created_date"
echo "======================================================"
SCRIPT
chmod +x /usr/local/bin/userinfo

# –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏
cat << 'SCRIPT' > /usr/local/bin/togglesub
#!/bin/bash
CONFIG_FILE="/usr/local/etc/xray/config.json"

emails=($(jq -r '.inbounds[0].settings.clients[].email' "$CONFIG_FILE"))

if [[ ${#emails[@]} -eq 0 ]]; then
    echo "–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—É—Å—Ç"
    exit 1
fi

echo "–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤:"
for i in "${!emails[@]}"; do
    email="${emails[$i]}"
    subscription=$(jq -r --arg email "$email" '.inbounds[0].settings.clients[] | select(.email == $email) | .metadata.subscription // "n/a"' "$CONFIG_FILE")
    echo "$((i+1)). $email (–ø–æ–¥–ø–∏—Å–∫–∞: $subscription)"
done

read -p "–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏: " client

if ! [[ "$client" =~ ^[0-9]+$ ]] || (( client < 1 || client > ${#emails[@]} )); then
    echo "–û—à–∏–±–∫–∞: –Ω–æ–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ ${#emails[@]}"
    exit 1
fi

selected_email="${emails[$((client - 1))]}"

# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–¥–ø–∏—Å–∫—É
current_sub=$(jq -r --arg email "$selected_email" '.inbounds[0].settings.clients[] | select(.email == $email) | .metadata.subscription // "n"' "$CONFIG_FILE")

# –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –ø–æ–¥–ø–∏—Å–∫—É
if [[ "$current_sub" == "y" ]]; then
    new_sub="n"
else
    new_sub="y"
fi

# –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥ –ø–æ email
jq --arg email "$selected_email" --arg new_sub "$new_sub" \
   '(.inbounds[0].settings.clients[] | select(.email == $email) | .metadata.subscription) = $new_sub' \
   "$CONFIG_FILE" > tmp.json && mv tmp.json "$CONFIG_FILE"

systemctl restart xray

echo ""
echo "‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è $selected_email –∏–∑–º–µ–Ω–µ–Ω–∞: $current_sub ‚Üí $new_sub"
SCRIPT
chmod +x /usr/local/bin/togglesub

systemctl restart xray

echo "Xray-core —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
mainuser

# –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏
cat << 'EOF' > $HOME/help

–ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ Xray:

    mainuser - –≤—ã–≤–æ–¥–∏—Ç —Å—Å—ã–ª–∫—É –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    newuser - —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–æ–¥–ø–∏—Å–∫–∏)
    rmuser - —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ü–û –ò–ú–ï–ù–ò (–ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
    disableuser - –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–ï–ó —É–¥–∞–ª–µ–Ω–∏—è (–ø–æ—Ä—Ç–∏—Ç UUID) ‚ú® –ù–û–í–û–ï
    listdisabled - –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚ú® –ù–û–í–û–ï
    sharelink - –≤—ã–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞—Ç—å –¥–ª—è –Ω–∏—Ö —Å—Å—ã–ª–∫–∏
    userlist - –≤—ã–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –∏ –¥–∞—Ç–∞–º–∏ —Å–æ–∑–¥–∞–Ω–∏—è
    userinfo - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    togglesub - –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (y/n)

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
    ‚Ä¢ –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∞ –æ–¥–Ω–æ–º –ø–æ—Ä—Ç—É 443
    ‚Ä¢ –û–±—â–∏–µ –∫–ª—é—á–∏ Reality –¥–ª—è –≤—Å–µ—Ö (–±–µ–∑–æ–ø–∞—Å–Ω–æ!)
    ‚Ä¢ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π UUID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
    ‚Ä¢ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏ (y/n)
    ‚Ä¢ –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–∞
    ‚Ä¢ –£–¥–∞–ª–µ–Ω–∏–µ –ü–û –ò–ú–ï–ù–ò (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–±–æ—è –∏–Ω–¥–µ–∫—Å–æ–≤!)
    ‚Ä¢ ‚ú® disableuser - –æ—Ç–∫–ª—é—á–∞–µ—Ç –∫–ª—é—á –ù–ï —É–¥–∞–ª—è—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á —Å —Ç–µ–º –∂–µ –∏–º–µ–Ω–µ–º
      ‚Üí –°—Ç–∞—Ä—ã–π –∫–ª—é—á –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
      ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è free –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ disableuser –¥–ª—è free –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
    1. Free –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –∫–ª—é—á –Ω–∞ 7 –¥–Ω–µ–π
    2. –ß–µ—Ä–µ–∑ 7 –¥–Ω–µ–π —Å–∫—Ä–∏–ø—Ç xray_time_control –≤—ã–∑—ã–≤–∞–µ—Ç disableuser
    3. UUID –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ DISABLED-timestamp (–∫–ª—é—á –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
    4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á
    5. –ü–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    6. –ù–µ –º–æ–∂–µ—Ç –æ–±–æ–π—Ç–∏ –ª–∏–º–∏—Ç –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

–§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
    /usr/local/etc/xray/config.json

–ö–ª—é—á–∏ Reality:
    /usr/local/etc/xray/.keys
    
–§–æ—Ä–º–∞—Ç –∫–ª—é—á–µ–π xray x25519:
    PrivateKey - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ (–≤ config.json)
    Password - –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (pbk –≤ —Å—Å—ã–ª–∫–µ)

–ö–æ–º–∞–Ω–¥—ã:
    systemctl restart xray          # –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
    systemctl status xray           # —Å—Ç–∞—Ç—É—Å
    journalctl -u xray -f           # –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–π:
    cat /usr/local/etc/xray/.keys   # –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–ª—é—á–µ–π

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ:
    –°–∫–∞—á–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
    wget https://raw.githubusercontent.com/LenderAuss/xray_users_monitor/main/auto_cleanup.sh
    chmod +x auto_cleanup.sh
    ./auto_cleanup.sh
    
    ‚ú® –ù–∞—Å—Ç—Ä–æ–π—Ç–µ xray_time_control –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è disableuser –≤–º–µ—Å—Ç–æ rmuser!

EOF

echo ""
echo "–°–ø—Ä–∞–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ ~/help"
echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "  ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""
echo "‚ú® –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
echo "   disableuser - –æ—Ç–∫–ª—é—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è"
echo "   listdisabled - –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
echo ""
echo "üí° –î–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è free –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:"
echo "   1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ disableuser –≤–º–µ—Å—Ç–æ rmuser –≤ xray_time_control"
echo "   2. Free –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Å–º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∫–ª—é—á–∏"
echo ""
